#!/bin/sh -ex
pkgbase=slack
vers=3.0.5_0.1
build=P1
arch=$(uname -m)
url="https://downloads.slack-edge.com/linux_releases/slack-${vers/_/-}.fc21.x86_64.rpm"
rpm=${url##*/}

P=$PWD/work

if [ ! -f ${rpm} ]; then
  wget $url
fi

if [ "$arch" = "x86_64" ]; then
  libdir="lib64"
else
  libdir="lib"
fi

if [ ! -d $P ]; then
  mkdir -p $P
fi

rm -rf $P/*

pushd $P
rpm2cpio ../${url##*/} | cpio -ivd
mv -v $P/usr/lib $P/usr/${libdir}
rm -vrf $P/etc
rm -vf $P/usr/bin/slack
ln -s ../${libdir}/slack/slack $P/usr/bin/slack

makepkg ../${pkgbase}-${vers}-${arch}-${build}.txz <<EOF
y
1
EOF
popd
